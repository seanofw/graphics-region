"use strict";function RegionError(n){this.message=(this.name="RegionError")+": "+n;var r=String((new Error).stack).split("\n");r.shift(),r.shift(),this.stack=r.join("\n")}RegionError.prototype=Object.create?Object.create(Error.prototype):new Error;var Region1D=function(){function n(n,a,o){if(a===b)"number"!=typeof o&&(o=x(n));else{if("undefined"!=typeof a||"undefined"!=typeof o)throw new e("Illegal access");p(n),o=x(n)}this._opaque=i({array:n,min:n.length?n[0]:r,max:n.length?n[n.length-1]:t,hash:o},b)}var r=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,e=RegionError,i=function(n,r){return function(t){if(t===r)return n;throw new e("Illegal access")}},a=function(n){return Array.isArray?Array.isArray(n):n instanceof Array},o=function(n,r){var t=0,e=0;return function(){return t>=n.length&&e>=r.length?null:t>=n.length?{x:r[e],kind:1&e++?-1:1,src:2}:e>=r.length||n[t]<r[e]?{x:n[t],kind:1&t++?-1:1,src:1}:{x:r[e],kind:1&e++?-1:1,src:2}}},u=function(n,r,t){if(!n.length&&!r.length)return[];var e=o(n,r),i=0,a=0,u=0,f=0,s=e(),h=[];do{1===s.src?i+=s.kind:a+=s.kind;for(var c=void 0;(c=e())&&c.x===s.x;)1===c.src?i+=c.kind:a+=c.kind;f=u,u=t(i,a),u!==f&&h.push(s.x),s=c}while(s);return h},f=function(n,r){return u(n,r,function(n,r){return n|r})},s=function(n,r){return u(n,r,function(n,r){return n&r})},h=function(n,r){return u(n,r,function(n,r){return n^r})},c=function(n,r){return u(n,r,function(n,r){return n&~r})},m=function(n,r,t){if(!n.length||!r.length)return"";if(n[n.length-1]<r[0]||r[r.length-1]<n[0])return"";var e=0,i=0,a=o(n,r),u=a(),f=3;do{1===u.src?e+=u.kind:i+=u.kind;for(var s=void 0;(s=a())&&s.x===u.x;)1===s.src?e+=s.kind:i+=s.kind;if(e&i){if(f|=4,t)return"intersect"}else i&~e?f&=-2:e&~i&&(f&=-3);u=s}while(u);switch(f){case 4:return"intersect";case 5:return"a-contain-b";case 6:return"b-contain-a";case 7:return"equal";default:return""}},g=function(n,r){if(!n.length)return!1;if(r<n[0]||r>n[n.length-1])return!1;if(n.length<=8){for(var t=0,e=n.length;e>t;t+=2)if(r>=n[t]&&r<n[t+1])return!0;return!1}for(var i=0,a=n.length,o=0;a>i;){var u=(i+a)/2&-1,f=n[u];if(r===f){o=u;break}f>r?a=u:(o=u,i=u+1)}return!(1&o)},l=function(n){var e=[],i=0;if(!n.length)return e.push(t),e.push(r),e;for(n[i]!=t?e.push(t):i++;i<n.length-1;)e.push(n[i++]);return n[i]!=r&&(e.push(n[i++]),e.push(r)),e},v=function(n,i,a){if(a=Number(a),!(a>t&&r>a))throw new e("Invalid translation delta");if(i=Number(i),!(i>t&&r>i)||0===i)throw new e("Invalid scale ratio");for(var o=[],u=0,f=n.length;f>u;u++)o[u]=n[u]*i+a;return o},w=function(n,r){if(n.length!=r.length)return!1;for(var t=0,e=n.length;e>t;t++)if(n[t]!=r[t])return!1;return!0},Y=function(n,r,t,e){for(var i=t-r,a=0,o=n.length;o>a;a+=2){var u=n[a],f=n[a+1];e.push({x:u,y:r,width:f-u,height:i,left:u,top:r,right:f,bottom:t})}return e},y=function(n){for(var r=[],t=0,e=n.length;e>t;t+=2)r.push(n[t]),r.push(n[t+1]);return r},x=function(n){for(var r=0,t=0,e=n.length;e>t;t++)r*=23,r+=0|n[t],r&=-1;return r},d=function(r){if(!(r instanceof n))throw new e("Object must be a Region1D instance.")},p=function(n){var r="Expected an ordered array of numeric start/end pairs.",t="Array start/end pairs are not in strictly ascending order.";if(!a(n)||1&n.length)throw new e(r);if(0!=n.length){var i=n[0];if("number"!=typeof i)throw new e(r);for(var o=1,u=n.length;u>o;o++){var f=n[o];if("number"!=typeof f)throw new e(r);if(i>=f)throw new e(t);i=f}}},b={},N=function(n){return n._opaque(b)};return n.prototype={union:function(r){d(r);var t=N(this),e=N(r);return new n(f(t.array,e.array),b)},intersect:function(r){d(r);var t=N(this),e=N(r);return new n(s(t.array,e.array),b)},subtract:function(r){d(r);var t=N(this),e=N(r);return new n(c(t.array,e.array),b)},xor:function(r){d(r);var t=N(this),e=N(r);return new n(h(t.array,e.array),b)},not:function(){var r=N(this);return new n(l(r.array),b)},transform:function(r,t){var e=N(this);return new n(v(e.array,r,t))},translate:function(r){var t=N(this);return new n(v(t.array,1,r))},scale:function(r){var t=N(this);return new n(v(t.array,r,0))},isEmpty:function(){return!N(this).array.length},getCount:function(){return N(this).array.length>>1},doesIntersect:function(n){return d(n),!!m(N(this).array,N(n).array,!0)},relate:function(n){return d(n),m(N(this).array,N(n).array,!1)},isPointIn:function(n){return g(N(this).array,Number(n))},equals:function(n){d(n);var r=N(this),t=N(n);return r.hash!=t.hash?!1:w(r.array,t.array)},getRawSpans:function(){var n=N(this);return y(n.array)},getAsRects:function(n,r,t){var e=N(this);return Y(e.array,n,r,t||[])},getBounds:function(){var n=N(this);return{min:n.min,max:n.max}},getHashCode:function(){return N(this).hash}},n.empty=new n([],b,0),n}(),Region2D=function(){function n(n,r){var t=r===T?n:"undefined"!=typeof n?x(n):d();this._opaque=o(t,T)}var r=void 0,t=void 0,e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=RegionError,o=function(n,r){return function(t){if(t===r)return n;throw new a("Illegal access")}},u=function(n){return Array.isArray?Array.isArray(n):n instanceof Array},f=function(n,r){var t=0,e=0,a=i,o=Region1D.empty;return function(){if(t>=n.length){if(e>=r.length)return null;var i={row1:o,row2:r[e].region,minY:Math.max(r[e].minY,a),maxY:a=r[e].maxY};return e++,i}if(e>=r.length){var u={row1:n[t].region,row2:o,minY:Math.max(n[t].minY,a),maxY:a=n[t].maxY};return t++,u}var f=n[t],s=r[e],h=Math.max(f.minY,a),c=Math.max(s.minY,a),m=void 0,g=void 0,l=void 0,v=void 0;h===c?(l=h,m=f.region,g=s.region,s.maxY<f.maxY?(a=v=s.maxY,e++):s.maxY===f.maxY?(a=v=f.maxY,t++,e++):(a=v=f.maxY,t++)):c>h?(l=h,m=f.region,g=o,c>=f.maxY?(a=v=f.maxY,t++):a=v=c):(l=c,m=o,g=s.region,h>=s.maxY?(a=v=s.maxY,e++):a=v=h);var w={row1:m,row2:g,minY:l,maxY:v};return w}},s=function(n,r,t){for(var a,o=f(n,r),u=null,s=[],h=e,c=i,m=0,g=0;a=o();){var l=t(a.row1,a.row2);if(!l.isEmpty())if(u&&l.equals(u.region)&&u.maxY==a.minY)u.maxY=a.maxY;else{s.push(u={region:l,minY:a.minY,maxY:a.maxY}),g+=l.getCount();var v=l.getBounds();v.min<h&&(h=v.min),v.max>c&&(c=v.max),m*=23,m+=0|l.getHashCode(),m&=-1}}var w={array:s,count:g,minX:h,minY:s.length?s[0].minY:e,maxX:c,maxY:s.length?s[s.length-1].maxY:i,hash:m};return w},h=function(n,r){return s(n,r,function(n,r){return n.union(r)})},c=function(n,r){return s(n,r,function(n,r){return n.intersect(r)})},m=function(n,r){return s(n,r,function(n,r){return n.xor(r)})},g=function(n,r){return s(n,r,function(n,r){return n.subtract(r)})},l=function(n,r,t,o,u){if(o=Number(o),u=Number(u),!(o>i&&e>o&&u>i&&e>u))throw new a("Invalid translation delta");if(r=Number(r),t=Number(t),!(r>i&&e>r&&0!==r&&t>i&&e>t&&0!==t))throw new a("Invalid scale ratio");for(var f=[],s=0,h=n.length;h>s;s++){var c=n[s];f[s]={region:c.region.transform(r,o),minY:c.minY*t+u,maxY:c.maxY*t+u}}return f},v=function(n,r){return!(n.minX>r.maxX||n.maxX<r.minX||n.minY>r.maxY||n.maxY<r.minY)},w="Cannot construct a Region2D from ",Y=w+"invalid rectangle data.",y=w+"a rectangle of zero or negative size.",x=function(n){var r=void 0,t=void 0,e=void 0,i=void 0;if("undefined"!=typeof HTMLElement&&n instanceof HTMLElement){var o=n.getBoundingClientRect();r=window.scrollX+o.left,e=window.scrollY+o.top,t=window.scrollX+o.right,i=window.scrollY+o.bottom}else if(u(n)){if(4!==n.length)throw new a(Y);r=Number(n[0]),e=Number(n[1]),t=Number(n[2]),i=Number(n[3])}else if("left"in n)r=Number(n.left),e=Number(n.top),t=Number(n.right),i=Number(n.bottom);else{if(!("x"in n))throw new a(Y);r=Number(n.x),e=Number(n.y),t=r+Number(n.width),i=e+Number(n.height)}if(r>=t||e>=i)throw new a(y);var f=new Region1D([r,t]),s={array:[{region:f,minY:e,maxY:i}],count:1,minX:r,minY:e,maxX:t,maxY:i,hash:f.getHashCode()};return s},d=function(){return{array:[],count:0,minX:e,minY:e,maxX:i,maxY:i,hash:0}},p="Invalid row data for row ",b=function(n){for(var r=i,t=0,a=e,o=i,u=0,f=[],s=0,h=n.length;h>s;s++){var c=n[s];if(c.minY<r||c.minY>=c.maxY||!(c.region instanceof Region1D))throw new RegionError(p+s);f.push({region:c.region,minY:c.minY,maxY:c.maxY});var m=c.region.getCount();if(!m)throw new RegionError(p+s);t+=m;var g=c.region.getBounds();g.min<a&&(a=g.min),g.max>o&&(o=g.max),u*=23,u+=0|c.region.getHashCode(),u&=-1}return{array:f,count:t,minX:a,minY:f.length?f[0].minY:e,maxX:o,maxY:f.length?f[f.length-1].maxY:i,hash:u}},N=function(n){return{x:n.minX,y:n.minY,width:n.maxX-n.minX,height:n.maxY-n.minY,left:n.minX,top:n.minY,right:n.maxX,bottom:n.maxY}},I=function(n){for(var r=n.array,t=[],e=0,i=r.length;i>e;e++){var a=r[e];t.push({minY:a.minY,maxY:a.maxY,region:a.region})}return t},R=function(n){for(var r=[],t=0,e=n.length;e>t;t++){var i=n[t];i.region.getAsRects(i.minY,i.maxY,r)}return r},X=function(n){return n.minX===i||n.minY===i||n.maxX===e||n.maxY===e},E=function(n,r){if(n.length!=r.length)return!1;for(var t=0,e=n.length;e>t;t++)if(!n[t].equals(r[t]))return!1;return!0},A=function(n,r){return!!c(n.array,r.array).array.length},k=function(n,r,t){var e=n.array;if(!e.length)return!1;if(t<n.minY||t>n.maxY||r<n.minX||r>n.maxX)return!1;if(e.length<=5){for(var i=0,a=e.length;a>i;i++)if(t>=e[i].minY&&t<e[i].maxY)return e[i].region.isPointIn(r);return!1}for(var o=0,u=e.length;u>o;){var f=(o+u)/2&-1,s=e[f];if(t>=s.minY&&t<s.maxY)return s.region.isPointIn(r);t<s.minY?u=f:o=f+1}return!1},C=function(r){if(!(r instanceof n))throw new a("Object must be a Region2D instance.")},T={},q=function(n){return n._opaque(T)};return n.prototype={union:function(r){C(r);var t=q(this),e=q(r);return new n(h(t.array,e.array),T)},intersect:function(r){C(r);var e=q(this),i=q(r);return v(e,i)?new n(c(e.array,i.array),T):t},subtract:function(r){C(r);var t=q(this),e=q(r);return v(t,e)?new n(g(t.array,e.array),T):this},xor:function(r){C(r);var t=q(this),e=q(r);return new n(m(t.array,e.array),T)},not:function(){var t=q(this),e=q(r);return new n(m(t.array,e.array),T)},transform:function(r,t,e,i){var a=q(this);return new n(b(l(a.array,r,t,e,i)),T)},translate:function(r,t){var e=q(this);return new n(b(l(e.array,1,1,r,t)),T)},scale:function(r,t){var e=q(this);return new n(b(l(e.array,r,t,0,0)),T)},isEmpty:function(){return!q(this).array.length},isInfinite:function(){return X(q(this))},isFinite:function(){return!X(q(this))},isRectangular:function(){return 1===q(this).count},doesIntersect:function(n){return C(n),A(q(this))},isPointIn:function(n,r){return k(q(this),Number(n),Number(r))},equals:function(n){C(n);var r=q(this),t=q(n);return r.hash!=t.hash||r.count!==t.count?!1:E(r.array,t.array)},getCount:function(){return q(this).count},getRects:function(){return R(q(this).array)},getRawRows:function(){return I(q(this).array)},getBounds:function(){return N(q(this))},getHashCode:function(){return q(this).hash}},n.infinite=r=new n([i,i,e,e]),n.empty=t=new n,n.fromRects=function(r){if(!r.length)return t;for(var e=new n(r[0]),i=1,a=r.length;a>i;i++)e=e.union(new n(r[i]));return e},n.fromRows=function(r){return new n(b(r),T)},n}();