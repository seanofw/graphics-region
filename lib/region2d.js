"use strict";function _interopRequireDefault(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Region2D=exports.Region1D=void 0;var _region1d=require("./region1d"),_region1d2=_interopRequireDefault(_region1d),Region2D=function(){var n=void 0,r=void 0,t=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,i=function(n,r){return function(t){if(t===r)return n;throw"Illegal access"}},a=function(n){return Array.isArray?Array.isArray(n):n instanceof Array},o=function(n,r){var t=0,i=0,a=e,o=_region1d2["default"].empty;return function(){if(t>=n.length){if(i>=r.length)return null;var e={row1:o,row2:r[i].region,minY:Math.max(r[i].minY,a),maxY:a=r[i].maxY};return i++,e}if(i>=r.length){var u={row1:n[t].region,row2:o,minY:Math.max(n[t].minY,a),maxY:a=n[t].maxY};return t++,u}var m=n[t],f=r[i],c=Math.max(m.minY,a),s=Math.max(f.minY,a),h=void 0,g=void 0,Y=void 0,x=void 0;c===s?(Y=c,h=m.region,g=f.region,f.maxY<m.maxY?(a=x=f.maxY,i++):f.maxY===m.maxY?(a=x=m.maxY,t++,i++):(a=x=m.maxY,t++)):s>c?(Y=c,h=m.region,g=o,s>=m.maxY?(a=x=m.maxY,t++):a=x=s):(Y=s,h=o,g=f.region,c>=f.maxY?(a=x=f.maxY,i++):a=x=c);var l={row1:h,row2:g,minY:Y,maxY:x};return l}},u=function(n,r,i){for(var a,u=o(n,r),m=null,f=[],c=t,s=e,h=0,g=0;a=u();){var Y=i(a.row1,a.row2);if(!Y.isEmpty())if(m&&Y.equals(m.region)&&m.maxY==a.minY)m.maxY=a.maxY;else{f.push(m={region:Y,minY:a.minY,maxY:a.maxY}),g+=Y.getCount();var x=Y.getBounds();x.min<c&&(c=x.min),x.max>s&&(s=x.max),h*=23,h+=0|Y.getHashCode(),h&=-1}}var l={array:f,count:g,minX:c,minY:f.length?f[0].minY:t,maxX:s,maxY:f.length?f[f.length-1].maxY:e,hash:h};return l},m=function(n,r){return u(n,r,function(n,r){return n.union(r)})},f=function(n,r){return u(n,r,function(n,r){return n.intersect(r)})},c=function(n,r){return u(n,r,function(n,r){return n.xor(r)})},s=function(n,r){return u(n,r,function(n,r){return n.subtract(r)})},h=function(n,r){return!(n.minX>r.maxX||n.maxX<r.minX||n.minY>r.maxY||n.maxY<r.minY)},g=function(n){var r=void 0,t=void 0,e=void 0,i=void 0;if(a(n)){if(4!==n.length)throw console.error("Cannot construct a Region2D; invalid rectangle data."),"Data error";r=Number(n[0]),e=Number(n[1]),t=Number(n[2]),i=Number(n[3])}else"left"in n?(r=Number(n.left),e=Number(n.top),t=Number(n.right),i=Number(n.bottom)):(r=Number(n.x),e=Number(n.y),t=r+Number(n.width),i=e+Number(n.height));if(r>=t||e>=i)throw console.error("Cannot construct a Region2D from a rectangle of zero or negative size."),"Data error";var o=new _region1d2["default"]([r,t]),u={array:[{region:o,minY:e,maxY:i}],count:1,minX:r,minY:e,maxX:t,maxY:i,hash:o.getHashCode()};return u},Y=function(){return{array:[],count:0,minX:t,minY:t,maxX:e,maxY:e,hash:0}},x=function(n){return{x:n.minX,y:n.minY,width:n.maxX-n.minX,height:n.maxY-n.minY,left:n.minX,top:n.minY,right:n.maxX,bottom:n.maxY}},l=function(n){for(var r=[],t=0,e=n.length;e>t;t++){var i=n[t];i.region.getAsRects(i.minY,i.maxY,r)}return r},v=function(n){return n.minX===e||n.minY===e||n.maxX===t||n.maxY===t},d=function(n,r){if(n.length!=r.length)return!1;for(var t=0,e=n.length;e>t;t++)if(!n[t].equals(r[t]))return!1;return!0},y=function(n,r){return!!f(n.array,r.array).array.length},b=function(n,r,t){var e=n.array;if(!e.length)return!1;if(t<n.minY||t>n.maxY||r<n.minX||r>n.maxX)return!1;if(e.length<=5){for(var i=0,a=e.length;a>i;i+=2)if(t>=e[i].minY&&t<e[i].maxY)return e[i].region.isPointIn(r);return!1}for(var o=0,u=e.length;u>o;){var m=(o+u)/2&-1,f=e[m];if(t>=f.minY&&t<f.maxY)return f.region.isPointIn(r);t<f.minY?u=m:o=m+1}return!1},p=function(n){if(!(n instanceof X))throw console.error("Object must be a Region2D instance."),"Type error"},w={},N=function(n){return n._opaque(w)},X=function(n,r){var t=r===w?n:"undefined"!=typeof n?g(n):Y();this._opaque=i(t,w)};return X.prototype={union:function(n){p(n);var r=N(this),t=N(n);return new X(m(r.array,t.array),w)},intersect:function(n){p(n);var t=N(this),e=N(n);return h(t,e)?new X(f(t.array,e.array),w):r},subtract:function(n){p(n);var r=N(this),t=N(n);return h(r,t)?new X(s(r.array,t.array),w):this},xor:function(n){p(n);var r=N(this),t=N(n);return new X(c(r.array,t.array),w)},not:function(){var r=N(this);return new X(c(r.array,n.array),w)},isEmpty:function(){return!N(this).array.length},isInfinite:function(){return v(N(this))},isFinite:function(){return!v(N(this))},isRectangular:function(){return 1===N(this).count},doesIntersect:function(n){return p(n),y(N(this))},isPointIn:function(n,r){return b(N(this),Number(n),Number(r))},equals:function(n){p(n);var r=N(this),t=N(n);return r.hash!=t.hash||r.count!==t.count?!1:d(r.array,t.array)},getCount:function(){return N(this).count},getRects:function(){return l(N(this).array)},getBounds:function(){return x(N(this))},getHashCode:function(){return N(this).hash}},X.infinite=n=new X([e,e,t,t]),X.empty=r=new X,X}();exports["default"]=Region2D,exports.Region1D=_region1d2["default"],exports.Region2D=Region2D;
//# sourceMappingURL=lib/region2d.js.map