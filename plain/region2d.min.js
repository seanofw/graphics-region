"use strict";var Region1D=function(){var n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,t=function(n,r){return function(t){if(t===r)return n;throw"Illegal access"}},e=function(n){return Array.isArray?Array.isArray(n):n instanceof Array},i=function(n,r){var t=0,e=0;return function(){return t>=n.length&&e>=r.length?null:t>=n.length?{x:r[e],kind:1&e++?-1:1,src:2}:e>=r.length||n[t]<r[e]?{x:n[t],kind:1&t++?-1:1,src:1}:{x:r[e],kind:1&e++?-1:1,src:2}}},u=function(n,r,t){if(!n.length&&!r.length)return[];var e=i(n,r),u=0,a=0,o=0,l=0,f=e(),s=[];do{1===f.src?u+=f.kind:a+=f.kind;for(var h=void 0;(h=e())&&h.x===f.x;)1===h.src?u+=h.kind:a+=h.kind;l=o,o=t(u,a),o!==l&&s.push(f.x),f=h}while(f);return s},a=function(n,r){return u(n,r,function(n,r){return n|r})},o=function(n,r){return u(n,r,function(n,r){return n&r})},l=function(n,r){return u(n,r,function(n,r){return n^r})},f=function(n,r){return u(n,r,function(n,r){return n&~r})},s=function(n,r,t){if(!n.length||!r.length)return"";if(n[n.length-1]<r[0]||r[r.length-1]<n[0])return"";var e=0,u=0,a=i(n,r),o=a(),l=3;do{1===o.src?e+=o.kind:u+=o.kind;for(var f=void 0;(f=a())&&f.x===o.x;)1===f.src?e+=f.kind:u+=f.kind;if(e&u){if(l|=4,t)return"intersect"}else u&~e?l&=-2:e&~u&&(l&=-3);o=f}while(o);switch(l){case 4:return"intersect";case 5:return"a-contain-b";case 6:return"b-contain-a";case 7:return"equal";default:return""}},h=function(n,r){if(!n.length)return!1;if(r<n[0]||r>n[n.length-1])return!1;if(n.length<=8){for(var t=0,e=n.length;e>t;t+=2)if(r>=n[t]&&r<n[t+1])return!0;return!1}for(var i=0,u=n.length,a=0;u>i;){var o=(i+u)/2&-1,l=n[o];if(r===l){a=o;break}l>r?u=o:(a=o,i=o+1)}return!(1&a)},c=function(t){var e=[],i=0;if(!t.length)return e.push(r),e.push(n),e;for(t[i]!=r?e.push(r):i++;i<t.length-1;)e.push(t[i++]);return t[i]!=n&&(e.push(t[i++]),e.push(n)),e},m=function(t,e,i){if(i=Number(i),!(i>r&&n>i))throw"Invalid translation delta";if(e=Number(e),!(e>r&&n>e)||0===e)throw"Invalid scale ratio";for(var u=[],a=0,o=t.length;o>a;a++)u[a]=t[a]*e+i;return u},y=function(n,r){if(n.length!=r.length)return!1;for(var t=0,e=n.length;e>t;t++)if(n[t]!=r[t])return!1;return!0},g=function(n,r,t,e){for(var i=t-r,u=0,a=n.length;a>u;u+=2){var o=n[u],l=n[u+1];e.push({x:o,y:r,width:l-o,height:i,left:o,top:r,right:l,bottom:t})}return e},x=function(n){for(var r=[],t=0,e=n.length;e>t;t+=2)r.push(n[t]),r.push(n[t+1]);return r},v=function(n){for(var r=0,t=0,e=n.length;e>t;t++)r*=23,r+=0|n[t],r&=-1;return r},d=function(n){if(!(n instanceof w))throw console.error("Object must be a Region1D instance."),"Type error"},p=function(n){var r="Type error",t="Expected an ordered array of numeric start/end pairs.",i="Data error",u="Array start/end pairs are not in strictly ascending order.";if(!e(n)||1&n.length)throw console.error(t),r;if(0!=n.length){var a=n[0];if("number"!=typeof a)throw console.error(t),r;for(var o=1,l=n.length;l>o;o++){var f=n[o];if("number"!=typeof f)throw console.error(t),r;if(a>=f)throw console.error(u),i;a=f}}},Y={},k=function(n){return n._opaque(Y)},w=function(e,i,u){if(i===Y)"number"!=typeof u&&(u=v(e));else{if("undefined"!=typeof i||"undefined"!=typeof u)throw"Illegal access";p(e),u=v(e)}this._opaque=t({array:e,min:e.length?e[0]:n,max:e.length?e[e.length-1]:r,hash:u},Y)};return w.prototype={union:function(n){d(n);var r=k(this),t=k(n);return new w(a(r.array,t.array),Y)},intersect:function(n){d(n);var r=k(this),t=k(n);return new w(o(r.array,t.array),Y)},subtract:function(n){d(n);var r=k(this),t=k(n);return new w(f(r.array,t.array),Y)},xor:function(n){d(n);var r=k(this),t=k(n);return new w(l(r.array,t.array),Y)},not:function(){var n=k(this);return new w(c(n.array),Y)},transform:function(n,r){var t=k(this);return new w(m(t.array,n,r))},translate:function(n){var r=k(this);return new w(m(r.array,1,n))},scale:function(n){var r=k(this);return new w(m(r.array,n,0))},isEmpty:function(){return!k(this).array.length},getCount:function(){return k(this).array.length>>1},doesIntersect:function(n){return d(n),!!s(k(this).array,k(n).array,!0)},relate:function(n){return d(n),s(k(this).array,k(n).array,!1)},isPointIn:function(n){return h(k(this).array,Number(n))},equals:function(n){d(n);var r=k(this),t=k(n);return r.hash!=t.hash?!1:y(r.array,t.array)},getRawSpans:function(){var n=k(this);return x(n.array)},getAsRects:function(n,r,t){var e=k(this);return g(e.array,n,r,t||[])},getBounds:function(){var n=k(this);return{min:n.min,max:n.max}},getHashCode:function(){return k(this).hash}},w.empty=new w([],Y,0),w}(),Region2D=function(){var n=void 0,r=void 0,t=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,i=function(n,r){return function(t){if(t===r)return n;throw"Illegal access"}},u=function(n){return Array.isArray?Array.isArray(n):n instanceof Array},a=function(n,r){var t=0,i=0,u=e,a=Region1D.empty;return function(){if(t>=n.length){if(i>=r.length)return null;var e={row1:a,row2:r[i].region,minY:Math.max(r[i].minY,u),maxY:u=r[i].maxY};return i++,e}if(i>=r.length){var o={row1:n[t].region,row2:a,minY:Math.max(n[t].minY,u),maxY:u=n[t].maxY};return t++,o}var l=n[t],f=r[i],s=Math.max(l.minY,u),h=Math.max(f.minY,u),c=void 0,m=void 0,y=void 0,g=void 0;s===h?(y=s,c=l.region,m=f.region,f.maxY<l.maxY?(u=g=f.maxY,i++):f.maxY===l.maxY?(u=g=l.maxY,t++,i++):(u=g=l.maxY,t++)):h>s?(y=s,c=l.region,m=a,h>=l.maxY?(u=g=l.maxY,t++):u=g=h):(y=h,c=a,m=f.region,s>=f.maxY?(u=g=f.maxY,i++):u=g=s);var x={row1:c,row2:m,minY:y,maxY:g};return x}},o=function(n,r,i){for(var u,o=a(n,r),l=null,f=[],s=t,h=e,c=0,m=0;u=o();){var y=i(u.row1,u.row2);if(!y.isEmpty())if(l&&y.equals(l.region)&&l.maxY==u.minY)l.maxY=u.maxY;else{f.push(l={region:y,minY:u.minY,maxY:u.maxY}),m+=y.getCount();var g=y.getBounds();g.min<s&&(s=g.min),g.max>h&&(h=g.max),c*=23,c+=0|y.getHashCode(),c&=-1}}var x={array:f,count:m,minX:s,minY:f.length?f[0].minY:t,maxX:h,maxY:f.length?f[f.length-1].maxY:e,hash:c};return x},l=function(n,r){return o(n,r,function(n,r){return n.union(r)})},f=function(n,r){return o(n,r,function(n,r){return n.intersect(r)})},s=function(n,r){return o(n,r,function(n,r){return n.xor(r)})},h=function(n,r){return o(n,r,function(n,r){return n.subtract(r)})},c=function(n){var r=[];if(n.length<1)return[];if(1===n.length){for(var t=n[0].region.getRawSpans(),e=n[0].minY,i=n[0].maxY,u=0;u<t.length;u+=2)r.push({x1:t[u],y1:e,x2:t[u+1],y2:e,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:t[u+1],y1:e,x2:t[u+1],y2:i,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:t[u+1],y1:i,x2:t[u],y2:i,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:t[u],y1:i,x2:t[u],y2:e,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1});return r}for(var a=n[0].region.getRawSpans(),o=n[0].minY,l=n[0].maxY,f=0;f<a.length;f+=2)r.push({x1:a[f],y1:o,x2:a[f+1],y2:o,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:a[f+1],y1:o,x2:a[f+1],y2:l,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:a[f],y1:l,x2:a[f],y2:o,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1});for(var s=1,h=n.length;h>s;s++){if(o=n[s].minY,l=n[s].maxY,o>n[s-1].maxY){for(var c=0;c<a.length;c+=2)r.push({x1:a[c+1],y1:n[s-1].maxY,x2:a[c],y2:n[s-1].maxY,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});a=n[s].region.getRawSpans();for(var m=0;m<a.length;m+=2)r.push({x1:a[m],y1:o,x2:a[m+1],y2:o,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1})}else{var y=n[s-1].region.subtract(n[s].region);a=y.getRawSpans();for(var g=0;g<a.length;g+=2)r.push({x1:a[g+1],y1:o,x2:a[g],y2:o,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});y=n[s].region.subtract(n[s-1].region),a=y.getRawSpans();for(var x=0;x<a.length;x+=2)r.push({x1:a[x],y1:o,x2:a[x+1],y2:o,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1})}a=n[s].region.getRawSpans();for(var v=0;v<a.length;v+=2)r.push({x1:a[v+1],y1:o,x2:a[v+1],y2:l,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:a[v],y1:l,x2:a[v],y2:o,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1})}for(var d=0;d<a.length;d+=2)r.push({x1:a[d+1],y1:l,x2:a[d],y2:l,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});return r},m=function(n){for(var r={},t=0,e=n.length;e>t;t++){var i=n[t];i.key1=i.x1+","+i.y1,i.key2=i.x2+","+i.y2,i.prev=t>0?n[t-1]:null,i.next=e-1>t?n[t+1]:null,i.key1 in r?r[i.key1].push(i):r[i.key1]=[i]}return r},y=function(n,r){for(var t=[],e=n[0],i=n[n.length-1],u=function(n){n.next?n.next.prev=n.prev:i=n.prev,n.prev?n.prev.next=n.next:e=n.next,n.used=!0},a=function(n,r){if(1===r.length&&!r.used)return r[0];for(var t=0,e=r.length;e>t;t++)if(!r[t].used)switch(n.kind){case"top":if("right"===r[t].kind)return r[t];break;case"right":if("bottom"===r[t].kind)return r[t];break;case"bottom":if("left"===r[t].kind)return r[t];break;case"left":if("top"===r[t].kind)return r[t]}for(var i=0,u=r.length;u>i;i++)if(!r[i].used)return r[i];throw"Edge generation failure."};e;){for(var o=[],l=e;"top"!==l.kind;)l=l.next;u(l),o.push({x:l.x1,y:l.y1});for(var f=l,s=l.x1,h=null;f.key2!==l.key1;){var c=r[f.key2];f=a(f,c),u(f),f.x1===s&&s===h?o[o.length-1].y=f.y1:o.push({x:f.x1,y:f.y1}),h=s,s=f.x1}o[0].x===s&&s===h&&o.pop(),t.push(o)}return t},g=function(n){if(!n.length)return[];var r=c(n),t=m(r),e=y(r,t);return e},x=function(n,r,i,u,a){if(u=Number(u),a=Number(a),!(u>e&&t>u&&a>e&&t>a))throw"Invalid translation delta";if(r=Number(r),i=Number(i),!(r>e&&t>r&&0!==r&&i>e&&t>i&&0!==i))throw"Invalid scale ratio";for(var o=[],l=0,f=n.length;f>l;l++){var s=n[l];o[l]={region:s.region.transform(r,u),minY:s.minY*i+a,maxY:s.maxY*i+a}}return o},v=function(n,r){return!(n.minX>r.maxX||n.maxX<r.minX||n.minY>r.maxY||n.maxY<r.minY)},d="Data error",p="Cannot construct a Region2D from ",Y=p+"invalid rectangle data.",k=p+"a rectangle of zero or negative size.",w=function(n){var r=void 0,t=void 0,e=void 0,i=void 0;if("undefined"!=typeof HTMLElement&&n instanceof HTMLElement){var a=n.getBoundingClientRect();r=window.scrollX+a.left,e=window.scrollY+a.top,t=window.scrollX+a.right,i=window.scrollY+a.bottom}else if(u(n)){if(4!==n.length)throw console.error(Y),d;r=Number(n[0]),e=Number(n[1]),t=Number(n[2]),i=Number(n[3])}else if("left"in n)r=Number(n.left),e=Number(n.top),t=Number(n.right),i=Number(n.bottom);else{if(!("x"in n))throw console.error(Y),d;r=Number(n.x),e=Number(n.y),t=r+Number(n.width),i=e+Number(n.height)}if(r>=t||e>=i)throw console.error(k),d;var o=new Region1D([r,t]),l={array:[{region:o,minY:e,maxY:i}],count:1,minX:r,minY:e,maxX:t,maxY:i,hash:o.getHashCode()};return l},b=function(){return{array:[],count:0,minX:t,minY:t,maxX:e,maxY:e,hash:0}},N=function(n){return{x:n.minX,y:n.minY,width:n.maxX-n.minX,height:n.maxY-n.minY,left:n.minX,top:n.minY,right:n.maxX,bottom:n.maxY}},I=function(n){for(var r=[],t=0,e=n.length;e>t;t++){var i=n[t];i.region.getAsRects(i.minY,i.maxY,r)}return r},X=function(n){return n.minX===e||n.minY===e||n.maxX===t||n.maxY===t},R=function(n,r){if(n.length!=r.length)return!1;for(var t=0,e=n.length;e>t;t++)if(!n[t].equals(r[t]))return!1;return!0},A=function(n,r){return!!f(n.array,r.array).array.length},E=function(n,r,t){var e=n.array;if(!e.length)return!1;if(t<n.minY||t>n.maxY||r<n.minX||r>n.maxX)return!1;if(e.length<=5){for(var i=0,u=e.length;u>i;i+=2)if(t>=e[i].minY&&t<e[i].maxY)return e[i].region.isPointIn(r);return!1}for(var a=0,o=e.length;o>a;){var l=(a+o)/2&-1,f=e[l];if(t>=f.minY&&t<f.maxY)return f.region.isPointIn(r);t<f.minY?o=l:a=l+1}return!1},T=function(n){if(!(n instanceof D))throw console.error("Object must be a Region2D instance."),"Type error"},q={},C=function(n){return n._opaque(q)},D=function(n,r){var t=r===q?n:"undefined"!=typeof n?w(n):b();this._opaque=i(t,q)};return D.prototype={union:function(n){T(n);var r=C(this),t=C(n);return new D(l(r.array,t.array),q)},intersect:function(n){T(n);var t=C(this),e=C(n);return v(t,e)?new D(f(t.array,e.array),q):r},subtract:function(n){T(n);var r=C(this),t=C(n);return v(r,t)?new D(h(r.array,t.array),q):this},xor:function(n){T(n);var r=C(this),t=C(n);return new D(s(r.array,t.array),q)},not:function(){var r=C(this),t=C(n);return new D(s(r.array,t.array),q)},transform:function(n,r,t,e){var i=C(this);return new D(x(i.array,n,r,t,e))},translate:function(n,r){var t=C(this);return new D(x(t.array,1,1,n,r))},scale:function(n,r){var t=C(this);return new D(x(t.array,n,r,0,0))},isEmpty:function(){return!C(this).array.length},isInfinite:function(){return X(C(this))},isFinite:function(){return!X(C(this))},isRectangular:function(){return 1===C(this).count},doesIntersect:function(n){return T(n),A(C(this))},isPointIn:function(n,r){return E(C(this),Number(n),Number(r))},equals:function(n){T(n);var r=C(this),t=C(n);return r.hash!=t.hash||r.count!==t.count?!1:R(r.array,t.array)},getCount:function(){return C(this).count},getRects:function(){return I(C(this).array)},getBounds:function(){return N(C(this))},getPath:function(){return g(C(this).array)},getHashCode:function(){return C(this).hash}},D.infinite=n=new D([e,e,t,t]),D.empty=r=new D,D.fromRects=function(n){if(!n.length)return r;for(var t=new D(n[0]),e=1,i=n.length;i>e;e++)t=t.union(new D(n[e]));return t},D}();