"use strict";function _interopRequireDefault(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Region2D=exports.Region1D=void 0;var _region1d=require("./region1d"),_region1d2=_interopRequireDefault(_region1d),Region2D=function(){var n=void 0,r=void 0,e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,i=function(n,r){return function(e){if(e===r)return n;throw"Illegal access"}},u=function(n){return Array.isArray?Array.isArray(n):n instanceof Array},a=function(n,r){var e=0,i=0,u=t,a=_region1d2["default"].empty;return function(){if(e>=n.length){if(i>=r.length)return null;var t={row1:a,row2:r[i].region,minY:Math.max(r[i].minY,u),maxY:u=r[i].maxY};return i++,t}if(i>=r.length){var o={row1:n[e].region,row2:a,minY:Math.max(n[e].minY,u),maxY:u=n[e].maxY};return e++,o}var l=n[e],f=r[i],s=Math.max(l.minY,u),m=Math.max(f.minY,u),x=void 0,h=void 0,y=void 0,g=void 0;s===m?(y=s,x=l.region,h=f.region,f.maxY<l.maxY?(u=g=f.maxY,i++):f.maxY===l.maxY?(u=g=l.maxY,e++,i++):(u=g=l.maxY,e++)):m>s?(y=s,x=l.region,h=a,m>=l.maxY?(u=g=l.maxY,e++):u=g=m):(y=m,x=a,h=f.region,s>=f.maxY?(u=g=f.maxY,i++):u=g=s);var c={row1:x,row2:h,minY:y,maxY:g};return c}},o=function(n,r,i){for(var u,o=a(n,r),l=null,f=[],s=e,m=t,x=0,h=0;u=o();){var y=i(u.row1,u.row2);if(!y.isEmpty())if(l&&y.equals(l.region)&&l.maxY==u.minY)l.maxY=u.maxY;else{f.push(l={region:y,minY:u.minY,maxY:u.maxY}),h+=y.getCount();var g=y.getBounds();g.min<s&&(s=g.min),g.max>m&&(m=g.max),x*=23,x+=0|y.getHashCode(),x&=-1}}var c={array:f,count:h,minX:s,minY:f.length?f[0].minY:e,maxX:m,maxY:f.length?f[f.length-1].maxY:t,hash:x};return c},l=function(n,r){return o(n,r,function(n,r){return n.union(r)})},f=function(n,r){return o(n,r,function(n,r){return n.intersect(r)})},s=function(n,r){return o(n,r,function(n,r){return n.xor(r)})},m=function(n,r){return o(n,r,function(n,r){return n.subtract(r)})},x=function(n){var r=[];if(n.length<1)return[];if(1===n.length){for(var e=n[0].region.getRawSpans(),t=n[0].minY,i=n[0].maxY,u=0;u<e.length;u+=2)r.push({x1:e[u],y1:t,x2:e[u+1],y2:t,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:e[u+1],y1:t,x2:e[u+1],y2:i,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:e[u+1],y1:i,x2:e[u],y2:i,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:e[u],y1:i,x2:e[u],y2:t,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1});return r}for(var a=n[0].region.getRawSpans(),o=n[0].minY,l=n[0].maxY,f=0;f<a.length;f+=2)r.push({x1:a[f],y1:o,x2:a[f+1],y2:o,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:a[f+1],y1:o,x2:a[f+1],y2:l,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:a[f],y1:l,x2:a[f],y2:o,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1});for(var s=1,m=n.length;m>s;s++){if(o=n[s].minY,l=n[s].maxY,o>n[s-1].maxY){for(var x=0;x<a.length;x+=2)r.push({x1:a[x+1],y1:n[s-1].maxY,x2:a[x],y2:n[s-1].maxY,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});a=n[s].region.getRawSpans();for(var h=0;h<a.length;h+=2)r.push({x1:a[h],y1:o,x2:a[h+1],y2:o,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1})}else{var y=n[s-1].region.subtract(n[s].region);a=y.getRawSpans();for(var g=0;g<a.length;g+=2)r.push({x1:a[g+1],y1:o,x2:a[g],y2:o,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});y=n[s].region.subtract(n[s-1].region),a=y.getRawSpans();for(var c=0;c<a.length;c+=2)r.push({x1:a[c],y1:o,x2:a[c+1],y2:o,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1})}a=n[s].region.getRawSpans();for(var v=0;v<a.length;v+=2)r.push({x1:a[v+1],y1:o,x2:a[v+1],y2:l,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:a[v],y1:l,x2:a[v],y2:o,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1})}for(var d=0;d<a.length;d+=2)r.push({x1:a[d+1],y1:l,x2:a[d],y2:l,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});return r},h=function(n){for(var r={},e=0,t=n.length;t>e;e++){var i=n[e];i.key1=i.x1+","+i.y1,i.key2=i.x2+","+i.y2,i.prev=e>0?n[e-1]:null,i.next=t-1>e?n[e+1]:null,i.key1 in r?r[i.key1].push(i):r[i.key1]=[i]}return r},y=function(n,r){for(var e=[],t=n[0],i=n[n.length-1],u=function(n){n.next?n.next.prev=n.prev:i=n.prev,n.prev?n.prev.next=n.next:t=n.next,n.used=!0},a=function(n,r){if(1===r.length&&!r.used)return r[0];for(var e=0,t=r.length;t>e;e++)if(!r[e].used)switch(n.kind){case"top":if("right"===r[e].kind)return r[e];break;case"right":if("bottom"===r[e].kind)return r[e];break;case"bottom":if("left"===r[e].kind)return r[e];break;case"left":if("top"===r[e].kind)return r[e]}for(var i=0,u=r.length;u>i;i++)if(!r[i].used)return r[i];throw"Edge generation failure."};t;){for(var o=[],l=t;"top"!==l.kind;)l=l.next;u(l),o.push({x:l.x1,y:l.y1});for(var f=l,s=l.x1,m=null;f.key2!==l.key1;){var x=r[f.key2];f=a(f,x),u(f),f.x1===s&&s===m?o[o.length-1].y=f.y1:o.push({x:f.x1,y:f.y1}),m=s,s=f.x1}o[0].x===s&&s===m&&o.pop(),e.push(o)}return e},g=function(n){if(!n.length)return[];var r=x(n),e=h(r),t=y(r,e);return t},c=function(n,r,i,u,a){if(u=Number(u),a=Number(a),!(u>t&&e>u&&a>t&&e>a))throw"Invalid translation delta";if(r=Number(r),i=Number(i),!(r>t&&e>r&&0!==r&&i>t&&e>i&&0!==i))throw"Invalid scale ratio";for(var o=[],l=0,f=n.length;f>l;l++){var s=n[l];o[l]={region:s.region.transform(r,u),minY:s.minY*i+a,maxY:s.maxY*i+a}}return o},v=function(n,r){return!(n.minX>r.maxX||n.maxX<r.minX||n.minY>r.maxY||n.maxY<r.minY)},d="Data error",Y="Cannot construct a Region2D from ",p=Y+"invalid rectangle data.",k=Y+"a rectangle of zero or negative size.",w=function(n){var r=void 0,e=void 0,t=void 0,i=void 0;if("undefined"!=typeof HTMLElement&&n instanceof HTMLElement){var a=n.getBoundingClientRect();r=window.scrollX+a.left,t=window.scrollY+a.top,e=window.scrollX+a.right,i=window.scrollY+a.bottom}else if(u(n)){if(4!==n.length)throw console.error(p),d;r=Number(n[0]),t=Number(n[1]),e=Number(n[2]),i=Number(n[3])}else if("left"in n)r=Number(n.left),t=Number(n.top),e=Number(n.right),i=Number(n.bottom);else{if(!("x"in n))throw console.error(p),d;r=Number(n.x),t=Number(n.y),e=r+Number(n.width),i=t+Number(n.height)}if(r>=e||t>=i)throw console.error(k),d;var o=new _region1d2["default"]([r,e]),l={array:[{region:o,minY:t,maxY:i}],count:1,minX:r,minY:t,maxX:e,maxY:i,hash:o.getHashCode()};return l},b=function(){return{array:[],count:0,minX:e,minY:e,maxX:t,maxY:t,hash:0}},N=function(n){return{x:n.minX,y:n.minY,width:n.maxX-n.minX,height:n.maxY-n.minY,left:n.minX,top:n.minY,right:n.maxX,bottom:n.maxY}},R=function(n){for(var r=[],e=0,t=n.length;t>e;e++){var i=n[e];i.region.getAsRects(i.minY,i.maxY,r)}return r},X=function(n){return n.minX===t||n.minY===t||n.maxX===e||n.maxY===e},I=function(n,r){if(n.length!=r.length)return!1;for(var e=0,t=n.length;t>e;e++)if(!n[e].equals(r[e]))return!1;return!0},_=function(n,r){return!!f(n.array,r.array).array.length},D=function(n,r,e){var t=n.array;if(!t.length)return!1;if(e<n.minY||e>n.maxY||r<n.minX||r>n.maxX)return!1;if(t.length<=5){for(var i=0,u=t.length;u>i;i+=2)if(e>=t[i].minY&&e<t[i].maxY)return t[i].region.isPointIn(r);return!1}for(var a=0,o=t.length;o>a;){var l=(a+o)/2&-1,f=t[l];if(e>=f.minY&&e<f.maxY)return f.region.isPointIn(r);e<f.minY?o=l:a=l+1}return!1},q=function(n){if(!(n instanceof A))throw console.error("Object must be a Region2D instance."),"Type error"},E={},M=function(n){return n._opaque(E)},A=function(n,r){var e=r===E?n:"undefined"!=typeof n?w(n):b();this._opaque=i(e,E)};return A.prototype={union:function(n){q(n);var r=M(this),e=M(n);return new A(l(r.array,e.array),E)},intersect:function(n){q(n);var e=M(this),t=M(n);return v(e,t)?new A(f(e.array,t.array),E):r},subtract:function(n){q(n);var r=M(this),e=M(n);return v(r,e)?new A(m(r.array,e.array),E):this},xor:function(n){q(n);var r=M(this),e=M(n);return new A(s(r.array,e.array),E)},not:function(){var r=M(this),e=M(n);return new A(s(r.array,e.array),E)},transform:function(n,r,e,t){var i=M(this);return new A(c(i.array,n,r,e,t))},translate:function(n,r){var e=M(this);return new A(c(e.array,1,1,n,r))},scale:function(n,r){var e=M(this);return new A(c(e.array,n,r,0,0))},isEmpty:function(){return!M(this).array.length},isInfinite:function(){return X(M(this))},isFinite:function(){return!X(M(this))},isRectangular:function(){return 1===M(this).count},doesIntersect:function(n){return q(n),_(M(this))},isPointIn:function(n,r){return D(M(this),Number(n),Number(r))},equals:function(n){q(n);var r=M(this),e=M(n);return r.hash!=e.hash||r.count!==e.count?!1:I(r.array,e.array)},getCount:function(){return M(this).count},getRects:function(){return R(M(this).array)},getBounds:function(){return N(M(this))},getPath:function(){return g(M(this).array)},getHashCode:function(){return M(this).hash}},A.infinite=n=new A([t,t,e,e]),A.empty=r=new A,A.fromRects=function(n){if(!n.length)return r;for(var e=new A(n[0]),t=1,i=n.length;i>t;t++)e=e.union(new A(n[t]));return e},A}();exports["default"]=Region2D,exports.Region1D=_region1d2["default"],exports.Region2D=Region2D;
//# sourceMappingURL=lib/region2d.js.map