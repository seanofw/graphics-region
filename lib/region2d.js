"use strict";function _interopRequireDefault(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Region2D=exports.Region1D=void 0;var _region1d=require("./region1d"),_region1d2=_interopRequireDefault(_region1d),Region2D=function(){var n=void 0,r=void 0,t=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,i=function(n,r){return function(t){if(t===r)return n;throw"Illegal access"}},o=function(n){return Array.isArray?Array.isArray(n):n instanceof Array},a=function(n,r){var t=0,i=0,o=e,a=_region1d2["default"].empty;return function(){if(t>=n.length){if(i>=r.length)return null;var e={row1:a,row2:r[i].region,minY:Math.max(r[i].minY,o),maxY:o=r[i].maxY};return i++,e}if(i>=r.length){var u={row1:n[t].region,row2:a,minY:Math.max(n[t].minY,o),maxY:o=n[t].maxY};return t++,u}var m=n[t],f=r[i],c=Math.max(m.minY,o),s=Math.max(f.minY,o),h=void 0,g=void 0,Y=void 0,l=void 0;c===s?(Y=c,h=m.region,g=f.region,f.maxY<m.maxY?(o=l=f.maxY,i++):f.maxY===m.maxY?(o=l=m.maxY,t++,i++):(o=l=m.maxY,t++)):s>c?(Y=c,h=m.region,g=a,s>=m.maxY?(o=l=m.maxY,t++):o=l=s):(Y=s,h=a,g=f.region,c>=f.maxY?(o=l=f.maxY,i++):o=l=c);var x={row1:h,row2:g,minY:Y,maxY:l};return x}},u=function(n,r,i){for(var o,u=a(n,r),m=null,f=[],c=t,s=e,h=0,g=0;o=u();){var Y=i(o.row1,o.row2);if(!Y.isEmpty())if(m&&Y.equals(m.region)&&m.maxY==o.minY)m.maxY=o.maxY;else{f.push(m={region:Y,minY:o.minY,maxY:o.maxY}),g+=Y.getCount();var l=Y.getBounds();l.min<c&&(c=l.min),l.max>s&&(s=l.max),h*=23,h+=0|Y.getHashCode(),h&=-1}}var x={array:f,count:g,minX:c,minY:f.length?f[0].minY:t,maxX:s,maxY:f.length?f[f.length-1].maxY:e,hash:h};return x},m=function(n,r){return u(n,r,function(n,r){return n.union(r)})},f=function(n,r){return u(n,r,function(n,r){return n.intersect(r)})},c=function(n,r){return u(n,r,function(n,r){return n.xor(r)})},s=function(n,r){return u(n,r,function(n,r){return n.subtract(r)})},h=function(n,r){return!(n.minX>r.maxX||n.maxX<r.minX||n.minY>r.maxY||n.maxY<r.minY)},g=function(n){var r=void 0,t=void 0,e=void 0,i=void 0;if(n instanceof HTMLElement){var a=n.getBoundingClientRect();r=window.scrollX+a.left,e=window.scrollY+a.top,t=window.scrollX+a.right,i=window.scrollY+a.bottom}else if(o(n)){if(4!==n.length)throw console.error("Cannot construct a Region2D; invalid rectangle data."),"Data error";r=Number(n[0]),e=Number(n[1]),t=Number(n[2]),i=Number(n[3])}else"left"in n?(r=Number(n.left),e=Number(n.top),t=Number(n.right),i=Number(n.bottom)):(r=Number(n.x),e=Number(n.y),t=r+Number(n.width),i=e+Number(n.height));if(r>=t||e>=i)throw console.error("Cannot construct a Region2D from a rectangle of zero or negative size."),"Data error";var u=new _region1d2["default"]([r,t]),m={array:[{region:u,minY:e,maxY:i}],count:1,minX:r,minY:e,maxX:t,maxY:i,hash:u.getHashCode()};return m},Y=function(){return{array:[],count:0,minX:t,minY:t,maxX:e,maxY:e,hash:0}},l=function(n){return{x:n.minX,y:n.minY,width:n.maxX-n.minX,height:n.maxY-n.minY,left:n.minX,top:n.minY,right:n.maxX,bottom:n.maxY}},x=function(n){for(var r=[],t=0,e=n.length;e>t;t++){var i=n[t];i.region.getAsRects(i.minY,i.maxY,r)}return r},d=function(n){return n.minX===e||n.minY===e||n.maxX===t||n.maxY===t},v=function(n,r){if(n.length!=r.length)return!1;for(var t=0,e=n.length;e>t;t++)if(!n[t].equals(r[t]))return!1;return!0},y=function(n,r){return!!f(n.array,r.array).array.length},w=function(n,r,t){var e=n.array;if(!e.length)return!1;if(t<n.minY||t>n.maxY||r<n.minX||r>n.maxX)return!1;if(e.length<=5){for(var i=0,o=e.length;o>i;i+=2)if(t>=e[i].minY&&t<e[i].maxY)return e[i].region.isPointIn(r);return!1}for(var a=0,u=e.length;u>a;){var m=(a+u)/2&-1,f=e[m];if(t>=f.minY&&t<f.maxY)return f.region.isPointIn(r);t<f.minY?u=m:a=m+1}return!1},b=function(n){if(!(n instanceof X))throw console.error("Object must be a Region2D instance."),"Type error"},p={},N=function(n){return n._opaque(p)},X=function(n,r){var t=r===p?n:"undefined"!=typeof n?g(n):Y();this._opaque=i(t,p)};return X.prototype={union:function(n){b(n);var r=N(this),t=N(n);return new X(m(r.array,t.array),p)},intersect:function(n){b(n);var t=N(this),e=N(n);return h(t,e)?new X(f(t.array,e.array),p):r},subtract:function(n){b(n);var r=N(this),t=N(n);return h(r,t)?new X(s(r.array,t.array),p):this},xor:function(n){b(n);var r=N(this),t=N(n);return new X(c(r.array,t.array),p)},not:function(){var r=N(this);return new X(c(r.array,n.array),p)},isEmpty:function(){return!N(this).array.length},isInfinite:function(){return d(N(this))},isFinite:function(){return!d(N(this))},isRectangular:function(){return 1===N(this).count},doesIntersect:function(n){return b(n),y(N(this))},isPointIn:function(n,r){return w(N(this),Number(n),Number(r))},equals:function(n){b(n);var r=N(this),t=N(n);return r.hash!=t.hash||r.count!==t.count?!1:v(r.array,t.array)},getCount:function(){return N(this).count},getRects:function(){return x(N(this).array)},getBounds:function(){return l(N(this))},getHashCode:function(){return N(this).hash}},X.infinite=n=new X([e,e,t,t]),X.empty=r=new X,X}();exports["default"]=Region2D,exports.Region1D=_region1d2["default"],exports.Region2D=Region2D;
//# sourceMappingURL=lib/region2d.js.map