"use strict";function _interopRequireDefault(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Region2D=exports.Region1D=void 0;var _region1d=require("./region1d"),_region1d2=_interopRequireDefault(_region1d),Region2D=function(){var n=void 0,r=void 0,e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,i=function(n,r){return function(e){if(e===r)return n;throw"Illegal access"}},u=function(n){return Array.isArray?Array.isArray(n):n instanceof Array},a=function(n,r){var e=0,i=0,u=t,a=_region1d2["default"].empty;return function(){if(e>=n.length){if(i>=r.length)return null;var t={row1:a,row2:r[i].region,minY:Math.max(r[i].minY,u),maxY:u=r[i].maxY};return i++,t}if(i>=r.length){var o={row1:n[e].region,row2:a,minY:Math.max(n[e].minY,u),maxY:u=n[e].maxY};return e++,o}var l=n[e],s=r[i],m=Math.max(l.minY,u),f=Math.max(s.minY,u),x=void 0,h=void 0,y=void 0,g=void 0;m===f?(y=m,x=l.region,h=s.region,s.maxY<l.maxY?(u=g=s.maxY,i++):s.maxY===l.maxY?(u=g=l.maxY,e++,i++):(u=g=l.maxY,e++)):f>m?(y=m,x=l.region,h=a,f>=l.maxY?(u=g=l.maxY,e++):u=g=f):(y=f,x=a,h=s.region,m>=s.maxY?(u=g=s.maxY,i++):u=g=m);var c={row1:x,row2:h,minY:y,maxY:g};return c}},o=function(n,r,i){for(var u,o=a(n,r),l=null,s=[],m=e,f=t,x=0,h=0;u=o();){var y=i(u.row1,u.row2);if(!y.isEmpty())if(l&&y.equals(l.region)&&l.maxY==u.minY)l.maxY=u.maxY;else{s.push(l={region:y,minY:u.minY,maxY:u.maxY}),h+=y.getCount();var g=y.getBounds();g.min<m&&(m=g.min),g.max>f&&(f=g.max),x*=23,x+=0|y.getHashCode(),x&=-1}}var c={array:s,count:h,minX:m,minY:s.length?s[0].minY:e,maxX:f,maxY:s.length?s[s.length-1].maxY:t,hash:x};return c},l=function(n,r){return o(n,r,function(n,r){return n.union(r)})},s=function(n,r){return o(n,r,function(n,r){return n.intersect(r)})},m=function(n,r){return o(n,r,function(n,r){return n.xor(r)})},f=function(n,r){return o(n,r,function(n,r){return n.subtract(r)})},x=function(n){var r=[];if(n.length<1)return[];if(1===n.length){for(var e=n[0].region.getRawSpans(),t=n[0].minY,i=n[0].maxY,u=0;u<e.length;u+=2)r.push({x1:e[u],y1:t,x2:e[u+1],y2:t,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:e[u+1],y1:t,x2:e[u+1],y2:i,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:e[u+1],y1:i,x2:e[u],y2:i,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:e[u],y1:i,x2:e[u],y2:t,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1});return r}for(var a=n[0].region.getRawSpans(),o=n[0].minY,l=n[0].maxY,s=0;s<a.length;s+=2)r.push({x1:a[s],y1:o,x2:a[s+1],y2:o,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:a[s+1],y1:o,x2:a[s+1],y2:l,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:a[s],y1:l,x2:a[s],y2:o,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1});for(var m=1,f=n.length;f>m;m++){if(o=n[m].minY,l=n[m].maxY,o>n[m-1].maxY){for(var x=0;x<a.length;x+=2)r.push({x1:a[x+1],y1:n[m-1].maxY,x2:a[x],y2:n[m-1].maxY,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});a=n[m].region.getRawSpans();for(var h=0;h<a.length;h+=2)r.push({x1:a[h],y1:o,x2:a[h+1],y2:o,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1})}else{var y=n[m-1].region.subtract(n[m].region);a=y.getRawSpans();for(var g=0;g<a.length;g+=2)r.push({x1:a[g+1],y1:o,x2:a[g],y2:o,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});y=n[m].region.subtract(n[m-1].region),a=y.getRawSpans();for(var c=0;c<a.length;c+=2)r.push({x1:a[c],y1:o,x2:a[c+1],y2:o,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1})}a=n[m].region.getRawSpans();for(var v=0;v<a.length;v+=2)r.push({x1:a[v+1],y1:o,x2:a[v+1],y2:l,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:a[v],y1:l,x2:a[v],y2:o,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1})}for(var d=0;d<a.length;d+=2)r.push({x1:a[d+1],y1:l,x2:a[d],y2:l,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});return r},h=function(n){for(var r={},e=0,t=n.length;t>e;e++){var i=n[e];i.key1=i.x1+","+i.y1,i.key2=i.x2+","+i.y2,i.prev=e>0?n[e-1]:null,i.next=t-1>e?n[e+1]:null,i.key1 in r?r[i.key1].push(i):r[i.key1]=[i]}return r},y=function(n,r){for(var e=[],t=n[0],i=n[n.length-1],u=function(n){n.next?n.next.prev=n.prev:i=n.prev,n.prev?n.prev.next=n.next:t=n.next,n.used=!0},a=function(n,r){if(1===r.length&&!r.used)return r[0];for(var e=0,t=r.length;t>e;e++)if(!r[e].used)switch(n.kind){case"top":if("right"===r[e].kind)return r[e];break;case"right":if("bottom"===r[e].kind)return r[e];break;case"bottom":if("left"===r[e].kind)return r[e];break;case"left":if("top"===r[e].kind)return r[e]}for(var i=0,u=r.length;u>i;i++)if(!r[i].used)return r[i];throw"Edge generation failure."};t;){for(var o=[],l=t;"top"!==l.kind;)l=l.next;u(l),o.push({x:l.x1,y:l.y1});for(var s=l,m=l.x1,f=null;s.key2!==l.key1;){var x=r[s.key2];s=a(s,x),u(s),s.x1===m&&m===f?o[o.length-1].y=s.y1:o.push({x:s.x1,y:s.y1}),f=m,m=s.x1}o[0].x===m&&m===f&&o.pop(),e.push(o)}return e},g=function(n){if(!n.length)return[];var r=x(n),e=h(r),t=y(r,e);return t},c=function(n,r,i,u,a){if(u=Number(u),a=Number(a),!(u>t&&e>u&&a>t&&e>a))throw"Invalid translation delta";if(r=Number(r),i=Number(i),!(r>t&&e>r&&0!==r&&i>t&&e>i&&0!==i))throw"Invalid scale ratio";for(var o=[],l=0,s=n.length;s>l;l++){var m=n[l];o[l]={region:m.region.transform(r,u),minY:m.minY*i+a,maxY:m.maxY*i+a}}return o},v=function(n,r){return!(n.minX>r.maxX||n.maxX<r.minX||n.minY>r.maxY||n.maxY<r.minY)},d=function(n){var r=void 0,e=void 0,t=void 0,i=void 0;if("undefined"!=typeof HTMLElement&&n instanceof HTMLElement){var a=n.getBoundingClientRect();r=window.scrollX+a.left,t=window.scrollY+a.top,e=window.scrollX+a.right,i=window.scrollY+a.bottom}else if(u(n)){if(4!==n.length)throw console.error("Cannot construct a Region2D; invalid rectangle data."),"Data error";r=Number(n[0]),t=Number(n[1]),e=Number(n[2]),i=Number(n[3])}else"left"in n?(r=Number(n.left),t=Number(n.top),e=Number(n.right),i=Number(n.bottom)):(r=Number(n.x),t=Number(n.y),e=r+Number(n.width),i=t+Number(n.height));if(r>=e||t>=i)throw console.error("Cannot construct a Region2D from a rectangle of zero or negative size."),"Data error";var o=new _region1d2["default"]([r,e]),l={array:[{region:o,minY:t,maxY:i}],count:1,minX:r,minY:t,maxX:e,maxY:i,hash:o.getHashCode()};return l},Y=function(){return{array:[],count:0,minX:e,minY:e,maxX:t,maxY:t,hash:0}},p=function(n){return{x:n.minX,y:n.minY,width:n.maxX-n.minX,height:n.maxY-n.minY,left:n.minX,top:n.minY,right:n.maxX,bottom:n.maxY}},k=function(n){for(var r=[],e=0,t=n.length;t>e;e++){var i=n[e];i.region.getAsRects(i.minY,i.maxY,r)}return r},w=function(n){return n.minX===t||n.minY===t||n.maxX===e||n.maxY===e},b=function(n,r){if(n.length!=r.length)return!1;for(var e=0,t=n.length;t>e;e++)if(!n[e].equals(r[e]))return!1;return!0},N=function(n,r){return!!s(n.array,r.array).array.length},R=function(n,r,e){var t=n.array;if(!t.length)return!1;if(e<n.minY||e>n.maxY||r<n.minX||r>n.maxX)return!1;if(t.length<=5){for(var i=0,u=t.length;u>i;i+=2)if(e>=t[i].minY&&e<t[i].maxY)return t[i].region.isPointIn(r);return!1}for(var a=0,o=t.length;o>a;){var l=(a+o)/2&-1,s=t[l];if(e>=s.minY&&e<s.maxY)return s.region.isPointIn(r);e<s.minY?o=l:a=l+1}return!1},X=function(n){if(!(n instanceof D))throw console.error("Object must be a Region2D instance."),"Type error"},I={},_=function(n){return n._opaque(I)},D=function(n,r){var e=r===I?n:"undefined"!=typeof n?d(n):Y();this._opaque=i(e,I)};return D.prototype={union:function(n){X(n);var r=_(this),e=_(n);return new D(l(r.array,e.array),I)},intersect:function(n){X(n);var e=_(this),t=_(n);return v(e,t)?new D(s(e.array,t.array),I):r},subtract:function(n){X(n);var r=_(this),e=_(n);return v(r,e)?new D(f(r.array,e.array),I):this},xor:function(n){X(n);var r=_(this),e=_(n);return new D(m(r.array,e.array),I)},not:function(){var r=_(this);return new D(m(r.array,n.array),I)},transform:function(n,r,e,t){var i=_(this);return new D(c(i.array,n,r,e,t))},translate:function(n,r){var e=_(this);return new D(c(e.array,1,1,n,r))},scale:function(n,r){var e=_(this);return new D(c(e.array,n,r,0,0))},isEmpty:function(){return!_(this).array.length},isInfinite:function(){return w(_(this))},isFinite:function(){return!w(_(this))},isRectangular:function(){return 1===_(this).count},doesIntersect:function(n){return X(n),N(_(this))},isPointIn:function(n,r){return R(_(this),Number(n),Number(r))},equals:function(n){X(n);var r=_(this),e=_(n);return r.hash!=e.hash||r.count!==e.count?!1:b(r.array,e.array)},getCount:function(){return _(this).count},getRects:function(){return k(_(this).array)},getBounds:function(){return p(_(this))},getPath:function(){return g(_(this).array)},getHashCode:function(){return _(this).hash}},D.infinite=n=new D([t,t,e,e]),D.empty=r=new D,D}();exports["default"]=Region2D,exports.Region1D=_region1d2["default"],exports.Region2D=Region2D;
//# sourceMappingURL=lib/region2d.js.map