"use strict";function _interopRequireDefault(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Region2D=exports.Region1D=void 0;var _region1d=require("./region1d"),_region1d2=_interopRequireDefault(_region1d),Region2D=function(){var n=void 0,r=void 0,e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,u=function(n,r){return function(e){if(e===r)return n;throw"Illegal access"}},i=function(n){return Array.isArray?Array.isArray(n):n instanceof Array},o=function(n,r){var e=0,u=0,i=t,o=_region1d2["default"].empty;return function(){if(e>=n.length){if(u>=r.length)return null;var t={row1:o,row2:r[u].region,minY:Math.max(r[u].minY,i),maxY:i=r[u].maxY};return u++,t}if(u>=r.length){var a={row1:n[e].region,row2:o,minY:Math.max(n[e].minY,i),maxY:i=n[e].maxY};return e++,a}var l=n[e],s=r[u],m=Math.max(l.minY,i),f=Math.max(s.minY,i),x=void 0,h=void 0,g=void 0,y=void 0;m===f?(g=m,x=l.region,h=s.region,s.maxY<l.maxY?(i=y=s.maxY,u++):s.maxY===l.maxY?(i=y=l.maxY,e++,u++):(i=y=l.maxY,e++)):f>m?(g=m,x=l.region,h=o,f>=l.maxY?(i=y=l.maxY,e++):i=y=f):(g=f,x=o,h=s.region,m>=s.maxY?(i=y=s.maxY,u++):i=y=m);var c={row1:x,row2:h,minY:g,maxY:y};return c}},a=function(n,r,u){for(var i,a=o(n,r),l=null,s=[],m=e,f=t,x=0,h=0;i=a();){var g=u(i.row1,i.row2);if(!g.isEmpty())if(l&&g.equals(l.region)&&l.maxY==i.minY)l.maxY=i.maxY;else{s.push(l={region:g,minY:i.minY,maxY:i.maxY}),h+=g.getCount();var y=g.getBounds();y.min<m&&(m=y.min),y.max>f&&(f=y.max),x*=23,x+=0|g.getHashCode(),x&=-1}}var c={array:s,count:h,minX:m,minY:s.length?s[0].minY:e,maxX:f,maxY:s.length?s[s.length-1].maxY:t,hash:x};return c},l=function(n,r){return a(n,r,function(n,r){return n.union(r)})},s=function(n,r){return a(n,r,function(n,r){return n.intersect(r)})},m=function(n,r){return a(n,r,function(n,r){return n.xor(r)})},f=function(n,r){return a(n,r,function(n,r){return n.subtract(r)})},x=function(n){var r=[];if(n.length<1)return[];if(1===n.length){for(var e=n[0].region.getRawSpans(),t=n[0].minY,u=n[0].maxY,i=0;i<e.length;i+=2)r.push({x1:e[i],y1:t,x2:e[i+1],y2:t,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:e[i+1],y1:t,x2:e[i+1],y2:u,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:e[i+1],y1:u,x2:e[i],y2:u,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:e[i],y1:u,x2:e[i],y2:t,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1});return r}for(var o=n[0].region.getRawSpans(),a=n[0].minY,l=n[0].maxY,s=0;s<o.length;s+=2)r.push({x1:o[s],y1:a,x2:o[s+1],y2:a,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:o[s+1],y1:a,x2:o[s+1],y2:l,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:o[s],y1:l,x2:o[s],y2:a,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1});for(var m=1,f=n.length;f>m;m++){if(a=n[m].minY,l=n[m].maxY,a>n[m-1].maxY){for(var x=0;x<o.length;x+=2)r.push({x1:o[x+1],y1:n[m-1].maxY,x2:o[x],y2:n[m-1].maxY,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});o=n[m].region.getRawSpans();for(var h=0;h<o.length;h+=2)r.push({x1:o[h],y1:a,x2:o[h+1],y2:a,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1})}else{var g=n[m-1].region.subtract(n[m].region);o=g.getRawSpans();for(var y=0;y<o.length;y+=2)r.push({x1:o[y+1],y1:a,x2:o[y],y2:a,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});g=n[m].region.subtract(n[m-1].region),o=g.getRawSpans();for(var c=0;c<o.length;c+=2)r.push({x1:o[c],y1:a,x2:o[c+1],y2:a,kind:"top",key1:null,key2:null,next:null,prev:null,used:!1})}o=n[m].region.getRawSpans();for(var d=0;d<o.length;d+=2)r.push({x1:o[d+1],y1:a,x2:o[d+1],y2:l,kind:"right",key1:null,key2:null,next:null,prev:null,used:!1}),r.push({x1:o[d],y1:l,x2:o[d],y2:a,kind:"left",key1:null,key2:null,next:null,prev:null,used:!1})}for(var v=0;v<o.length;v+=2)r.push({x1:o[v+1],y1:l,x2:o[v],y2:l,kind:"bottom",key1:null,key2:null,next:null,prev:null,used:!1});return r},h=function(n){for(var r={},e=0,t=n.length;t>e;e++){var u=n[e];u.key1=u.x1+","+u.y1,u.key2=u.x2+","+u.y2,u.prev=e>0?n[e-1]:null,u.next=t-1>e?n[e+1]:null,u.key1 in r?r[u.key1].push(u):r[u.key1]=[u]}return r},g=function(n,r){for(var e=[],t=n[0],u=n[n.length-1],i=function(n){n.next?n.next.prev=n.prev:u=n.prev,n.prev?n.prev.next=n.next:t=n.next,n.used=!0},o=function(n,r){if(1===r.length&&!r.used)return r[0];for(var e=0,t=r.length;t>e;e++)if(!r[e].used)switch(n.kind){case"top":if("right"===r[e].kind)return r[e];break;case"right":if("bottom"===r[e].kind)return r[e];break;case"bottom":if("left"===r[e].kind)return r[e];break;case"left":if("top"===r[e].kind)return r[e]}for(var u=0,i=r.length;i>u;u++)if(!r[u].used)return r[u];throw"Edge generation failure."};t;){for(var a=[],l=t;"top"!==l.kind;)l=l.next;i(l),a.push({x:l.x1,y:l.y1});for(var s=l;s.key2!==l.key1;){var m=r[s.key2];s=o(s,m),i(s),a.push({x:s.x1,y:s.y1})}e.push(a)}return e},y=function(n){if(!n.length)return[];var r=x(n),e=h(r),t=g(r,e);return t},c=function(n,r){return!(n.minX>r.maxX||n.maxX<r.minX||n.minY>r.maxY||n.maxY<r.minY)},d=function(n){var r=void 0,e=void 0,t=void 0,u=void 0;if(n instanceof HTMLElement){var o=n.getBoundingClientRect();r=window.scrollX+o.left,t=window.scrollY+o.top,e=window.scrollX+o.right,u=window.scrollY+o.bottom}else if(i(n)){if(4!==n.length)throw console.error("Cannot construct a Region2D; invalid rectangle data."),"Data error";r=Number(n[0]),t=Number(n[1]),e=Number(n[2]),u=Number(n[3])}else"left"in n?(r=Number(n.left),t=Number(n.top),e=Number(n.right),u=Number(n.bottom)):(r=Number(n.x),t=Number(n.y),e=r+Number(n.width),u=t+Number(n.height));if(r>=e||t>=u)throw console.error("Cannot construct a Region2D from a rectangle of zero or negative size."),"Data error";var a=new _region1d2["default"]([r,e]),l={array:[{region:a,minY:t,maxY:u}],count:1,minX:r,minY:t,maxX:e,maxY:u,hash:a.getHashCode()};return l},v=function(){return{array:[],count:0,minX:e,minY:e,maxX:t,maxY:t,hash:0}},p=function(n){return{x:n.minX,y:n.minY,width:n.maxX-n.minX,height:n.maxY-n.minY,left:n.minX,top:n.minY,right:n.maxX,bottom:n.maxY}},Y=function(n){for(var r=[],e=0,t=n.length;t>e;e++){var u=n[e];u.region.getAsRects(u.minY,u.maxY,r)}return r},k=function(n){return n.minX===t||n.minY===t||n.maxX===e||n.maxY===e},w=function(n,r){if(n.length!=r.length)return!1;for(var e=0,t=n.length;t>e;e++)if(!n[e].equals(r[e]))return!1;return!0},b=function(n,r){return!!s(n.array,r.array).array.length},R=function(n,r,e){var t=n.array;if(!t.length)return!1;if(e<n.minY||e>n.maxY||r<n.minX||r>n.maxX)return!1;if(t.length<=5){for(var u=0,i=t.length;i>u;u+=2)if(e>=t[u].minY&&e<t[u].maxY)return t[u].region.isPointIn(r);return!1}for(var o=0,a=t.length;a>o;){var l=(o+a)/2&-1,s=t[l];if(e>=s.minY&&e<s.maxY)return s.region.isPointIn(r);e<s.minY?a=l:o=l+1}return!1},N=function(n){if(!(n instanceof I))throw console.error("Object must be a Region2D instance."),"Type error"},X={},_=function(n){return n._opaque(X)},I=function(n,r){var e=r===X?n:"undefined"!=typeof n?d(n):v();this._opaque=u(e,X)};return I.prototype={union:function(n){N(n);var r=_(this),e=_(n);return new I(l(r.array,e.array),X)},intersect:function(n){N(n);var e=_(this),t=_(n);return c(e,t)?new I(s(e.array,t.array),X):r},subtract:function(n){N(n);var r=_(this),e=_(n);return c(r,e)?new I(f(r.array,e.array),X):this},xor:function(n){N(n);var r=_(this),e=_(n);return new I(m(r.array,e.array),X)},not:function(){var r=_(this);return new I(m(r.array,n.array),X)},isEmpty:function(){return!_(this).array.length},isInfinite:function(){return k(_(this))},isFinite:function(){return!k(_(this))},isRectangular:function(){return 1===_(this).count},doesIntersect:function(n){return N(n),b(_(this))},isPointIn:function(n,r){return R(_(this),Number(n),Number(r))},equals:function(n){N(n);var r=_(this),e=_(n);return r.hash!=e.hash||r.count!==e.count?!1:w(r.array,e.array)},getCount:function(){return _(this).count},getRects:function(){return Y(_(this).array)},getBounds:function(){return p(_(this))},getPath:function(){return y(_(this).array)},getEdges:function(){return x(_(this).array)},getHashCode:function(){return _(this).hash}},I.infinite=n=new I([t,t,e,e]),I.empty=r=new I,I}();exports["default"]=Region2D,exports.Region1D=_region1d2["default"],exports.Region2D=Region2D;
//# sourceMappingURL=lib/region2d.js.map